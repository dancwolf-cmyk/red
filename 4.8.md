## 4.8 Step-Wise Decomposition Study on Mixed Arithmetic (Modular Execution)

This section evaluates the upper bound of modular arithmetic reasoning by
decoupling **program decomposition** from **expert execution**. Unlike preceding
sections, the focus here is strictly on evaluation rather than training.

---

### 4.8.1 Objective

The experiment addresses the following question:

> *Given a correct step-wise computational structure, how accurately can independently trained experts execute multi-step arithmetic?*

This analysis reveals the theoretical performance ceiling of modular arithmetic
systems independent of structural prediction errors.

---

### 4.8.2 Experimental Components

Only the components required for evaluation are listed:

- Step decomposer outputs (pretrained; not retrained here)  
- Arithmetic experts for addition and subtraction  
- Three routing strategies for comparison:  
  - RED router  
  - Classical MoE router  
  - AllFix (equal-weight fusion)

No training hyperparameters are repeated, as they were detailed in Section 4.5.

---

### 4.8.3 RED Modular Execution (Upper Bound)

RED receives the decomposed program and routes each step to the appropriate
expert. Performance is nearly perfect across all sequence lengths:

| Setting | Accuracy | Macro-F1 |
|---------|----------|-----------|
| **All expressions (2–4 steps)** | **0.9920** | **0.9828** |
| 2-step | 0.9912 | 0.9831 |
| 3-step | 0.9935 | 0.9843 |
| 4-step | 0.9910 | 0.9812 |

**Interpretation:**  
RED exceeds 0.99 on all depths, showing that expert execution is not a limiting
factor. Task difficulty in Section 4.7 arises primarily from learning the
computational structure, not from executing it.

---

### 4.8.4 AllFix Baseline (Lower Bound)

AllFix applies equal weights to experts without routing or specialization.

| Setting | Accuracy | Macro-F1 |
|---------|----------|-----------|
| **All expressions (2–4 steps)** | **0.3216** | **0.3014** |
| 2-step | 0.4121 | 0.3879 |
| 3-step | 0.3313 | 0.3094 |
| 4-step | 0.2674 | 0.2455 |

**Interpretation:**  
Routing is essential for multi-step computation. Without it, expert outputs
collapse and errors accumulate rapidly with increasing depth.

---

### 4.8.5 Classical MoE Baseline (Middle Bound)

| Setting | Accuracy | Macro-F1 |
|---------|----------|-----------|
| **All expressions (2–4 steps)** | **0.8391** | **0.8279** |
| 2-step | 0.8603 | 0.8455 |
| 3-step | 0.8411 | 0.8343 |
| 4-step | 0.8267 | 0.8078 |

**Interpretation:**  
MoE routing improves substantially over AllFix but exhibits instability under
multi-step execution, leading to compounding errors with increasing depth.

---

### 4.8.6 Key Findings

1. **Execution is easy; structure is hard.**  
   With correct decomposition, modular execution reaches above $0.99$.

2. **Routing governs system performance.**  
   AllFix (0.32) → MoE (0.84) → RED (0.99+) forms a clear hierarchy of routing
   effectiveness.

3. **Modular reasoning is compositional.**  
   - Step decomposer: planning  
   - Experts: computation  
   - Router: assignment  
   These modules interact cleanly and predictably when decoupled.

4. **The experiment validates the modular architecture.**  
   Section 4.7’s limitations stem from implicit structural learning rather than
   from the expert modules themselves.

---

### 4.8.7 Summary

This section isolates the functional capabilities of modular arithmetic systems
by providing perfect structural input. The results complete the conceptual
progression of the chapter:

- **Section 4.5:** how the modules are trained  
- **Section 4.7:** end-to-end performance with implicit structure learning  
- **Section 4.8:** upper-bound performance when structure is explicitly provided  

This separation clarifies the roles of decomposition, routing, and expert
execution in modular arithmetic reasoning.
